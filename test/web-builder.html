<!--This file was automatically generated by {flock}-->
<!--Although it looks tempting to edit this, don't, for your own sake-->
<html>

<head>
	<title>Swarm Web Builder</title>
	<style>
		body {
			color: #eeeeee;
			background-color: #111111;
			font-family: sans-serif;
			padding: 50px;
		}

		textarea,
		p {
			width: 100%;
			padding: 20px;
			background-color: rgba(255, 255, 255, 0.1);
			color: white;
			border: 2px solid rgba(255, 255, 255, 0.1);
			border-radius: 5px;
			box-sizing: border-box;
		}

	</style>
</head>

<body>
	<script>
		function build(root, included, userSource) {
			function shouldInclude(dependents) {
				for (const dependant of dependents) {
					if (included.includes(dependant)) {
						return true;
					}
				}
				return false;
			}
			function buildModule(module) {
				let o = '';
				o += `((async()=>{`;
				if (module.css) {
					o += `const css=document.createElement("style");`;
					o += `css.appendChild(document.createTextNode(${JSON.stringify(module.css)}));`;
					o += `document.body.appendChild(css);`;
				}
				o += `const base = await((async()=>{`;
				o += module.javascript;
				o += `})());`;
				for (const subModule in module.subNodes) {
					if (shouldInclude(module.subNodes[subModule].dependents)) {
						o += `base.${subModule} = await ${buildModule(module.subNodes[subModule])};`;
					}
				}
				o += 'return base;';
				o += `})())`;
				return o;
			}
			return `void ((async()=>{window.swarm = await ${buildModule(root)};(async ()=>{${userSource}})()})())`;
		};

		window.onload = () => {
			setInterval(() => {
				const dependencies = document.querySelector("#input").value.split("\n");
				const userSource = document.querySelector("#src").value;

				let output = build({ "dependents": ["swarm", "swarm.eleven", "swarm.thirteen"], "javascript": "return{twelve:12};", "subNodes": { "eleven": { "dependents": ["swarm.eleven", "swarm.thirteen"], "javascript": "return 11;", "subNodes": {}, "name": "swarm.eleven" }, "thirteen": { "dependents": ["swarm.thirteen"], "javascript": "return{getThirteen(){return swarm.eleven+2}};", "subNodes": {}, "name": "swarm.thirteen" } }, "css": "body {\n  background-color: #3498db;\n  color: #fff;\n}\n\nh1 {\n  font-size: 2rem;\n  margin-bottom: 1rem;\n}\n\np {\n  font-size: 1.5rem;\n  line-height: 1.5;\n}", "name": "swarm" }, dependencies, userSource);

				if (!userSource.includes("await swarm.init")) {
					output = "Please await swarm.init() somewhere in your code.";
				}

				const outputPanel = document.querySelector("#output");

				if (outputPanel.value != output) {
					console.log(output);
					outputPanel.value = output;
				}
			});
		}</script>
	<h1>Swarm Web Builder</h1>
	<h2>Dependencies</h2><textarea id="input">
swarm
swarm.ui
</textarea>
	<h2>Your code (make sure to await swarm.init())</h2><textarea
		id="src">try { await swarm.init(); alert("success!") } catch (err) { alert(JSON.stringify(err)) }</textarea>
	<h2>Generated output</h2><textarea id="output"></textarea>
</body>

</html>
